# V6.2: WordNet Path Analysis & Depth Visualization

**Created**: 2025-10-03
**Status**: ✅ Complete and Tested

---

## Overview

V6.2 extends v6.1 with comprehensive **WordNet hierarchy path analysis** to better understand how granularity levels map to WordNet depths and where object paths merge in the taxonomy.

## Key Enhancements Over V6.1

### New Visualizations

1. **`wordnet_paths_tree.png`** - Complete WordNet hypernym paths from objects to root
   - Shows all paths in hierarchical tree layout
   - Node colors indicate merge intensity (how many objects converge)
   - Depth labels on each node
   - Size scaled by number of merged objects

2. **`wordnet_merge_analysis.png`** - Merge point visualization
   - Scatter plot showing where objects converge in the hierarchy
   - X-axis: depth from root
   - Y-axis: merge point index
   - Point size: number of objects merging
   - Helps identify optimal granularity boundaries

3. **`depth_distribution.png`** - Two-panel depth analysis
   - Left: Overall node depth distribution across all objects
   - Right: Granularity level mapping (Fine/Mid/Coarse by depth)
   - Reveals which depths correspond to each granularity level

### New Data Exports

4. **`wordnet_paths_data.json`** - Complete path data with depths
   - Full hypernym paths for every object
   - All nodes with depth information
   - Merge point details

5. **`WORDNET_ANALYSIS_REPORT.md`** - Detailed analysis report
   - Depth statistics and distributions
   - Granularity depth ranges
   - Top merge points
   - Sample object paths from leaf to root

---

## Pipeline Structure

### Scripts

1. **`visualize_wordnet_paths.py`** - Core WordNet analysis functions
   - `extract_all_wordnet_paths()` - Extract paths with depth tracking
   - `analyze_granularity_depths()` - Map granularities to depths
   - `visualize_wordnet_paths_tree()` - Generate path tree visualization
   - `visualize_merge_analysis()` - Generate merge point analysis
   - `visualize_depth_distribution()` - Generate depth distribution plots
   - `generate_wordnet_analysis_report()` - Generate markdown report

2. **`visualize_scene_graph_hierarchy_v6_2.py`** - Main pipeline orchestrator
   - Integrates v6.1 hierarchy building with WordNet path analysis
   - Generates all v6.1 outputs + new WordNet visualizations
   - Produces comprehensive reports

3. **`batch_sample_vg_v6_2.py`** - Batch processing with aggregation
   - Process multiple images
   - Aggregate WordNet statistics across samples
   - Generate batch-level insights

---

## Usage

### Single Image

```bash
cd /home/jiachen/scratch/graph_reasoning/HCNMN/inspect

# Process single image
conda run -n hcnmn python visualize_scene_graph_hierarchy_v6_2.py \
  --image_id 498335 \
  --vg_dir /home/jiachen/scratch/graph_reasoning/HCNMN/data/vg \
  --output_dir /home/jiachen/scratch/graph_reasoning/HCNMN/inspect/vg/v6.2
```

### Batch Processing

```bash
# Process 10 samples
conda run -n hcnmn python batch_sample_vg_v6_2.py \
  --num_samples 10 \
  --min_objects 10 \
  --max_objects 30 \
  --seed 44 \
  --output_dir /home/jiachen/scratch/graph_reasoning/HCNMN/inspect/vg/v6.2
```

---

## Output Structure

```
vg/v6.2/
├── sample_<IMAGE_ID>/
│   ├── original_scene_graph.png
│   ├── hierarchical_ontology_tree.png
│   ├── merged_fine.png
│   ├── merged_mid.png
│   ├── merged_coarse.png
│   ├── merged_comparison.png
│   ├── wordnet_paths_tree.png          ⭐ NEW
│   ├── wordnet_merge_analysis.png      ⭐ NEW
│   ├── depth_distribution.png          ⭐ NEW
│   ├── ontology_data.json
│   ├── wordnet_paths_data.json         ⭐ NEW
│   ├── MERGED_SCENE_GRAPH_REPORT.md
│   └── WORDNET_ANALYSIS_REPORT.md      ⭐ NEW
├── BATCH_SAMPLING_REPORT_V6_2.md
└── batch_sampling_data_v6_2.json
```

---

## Key Insights from Example (Image 498335)

### Depth Statistics

| Granularity | Depth Range | Average Depth | Concept Count |
|-------------|-------------|---------------|---------------|
| **Fine** | 4-10 | 7.5 | 16 |
| **Mid** | 3-7 | 5.0 | 6 |
| **Coarse** | 4-4 | 4.0 | 9 |

### Top Merge Points

| Node | Depth | Merged Objects | Count |
|------|-------|----------------|-------|
| entity | 0 | sign, letter, clock, street, pot (+13 more) | 18 |
| physical entity | 1 | letter, clock, street, pot, face (+9 more) | 14 |
| object | 2 | letter, clock, street, pot, edge (+7 more) | 12 |
| whole | 3 | letter, clock, street, pot, balcony (+6 more) | 11 |
| **artifact** | **4** | letter, clock, street, pot, balcony (+4 more) | **9** |

### Key Findings

1. **Coarse level (depth 4)** shows strong convergence:
   - 9 objects merge at "artifact" (depth 4)
   - Matches v6.1 strategy of using depth-4 for coarse granularity
   - ✅ Validates current depth threshold

2. **Mid level (depth 3-7, avg 5.0)** uses semantic categories:
   - More variable depth due to semantic category mapping
   - Semantic categories override strict depth-based selection
   - Results in better compression (1.80x in this example)

3. **Fine level (depth 4-10, avg 7.5)** are specific objects:
   - Leaf or near-leaf nodes in WordNet
   - High variability reflects diverse object types

---

## Benefits for Granularity Refinement

### 1. Data-Driven Depth Selection

- Visualize actual depth distributions
- Identify natural clustering points in hierarchy
- Adjust depth thresholds based on empirical data

### 2. Merge Behavior Analysis

- See where objects naturally group
- Identify which intermediate concepts are most useful
- Validate semantic category choices against WordNet structure

### 3. Path Comparison

- Compare different objects' paths side-by-side
- Understand why some objects merge early vs. late
- Debug unexpected granularity assignments

### 4. Cross-Sample Aggregation

- Batch processing aggregates statistics across multiple images
- Identify consistent depth patterns
- Recommend optimal depth thresholds for dataset

---

## Comparison: V6.1 vs V6.2

| Feature | V6.1 | V6.2 |
|---------|------|------|
| Hierarchy Building | ✅ Semantic categories + depth-4 | ✅ Same |
| Merged Scene Graphs | ✅ Fine/Mid/Coarse | ✅ Same |
| Hierarchy Tree | ✅ 3-column tree | ✅ Same |
| **WordNet Path Tree** | ❌ | ✅ Full path visualization |
| **Merge Point Analysis** | ❌ | ✅ Depth-based scatter plot |
| **Depth Distribution** | ❌ | ✅ Histogram + granularity mapping |
| **WordNet Paths Data** | ❌ | ✅ JSON export with depths |
| **WordNet Analysis Report** | ❌ | ✅ Comprehensive depth analysis |
| **Batch Aggregation** | Basic stats | ✅ Enhanced with depth analysis |

---

## Future Refinement Opportunities

Based on v6.2 analysis, potential improvements:

1. **Adaptive Depth Selection**
   - Use merge point analysis to automatically determine optimal depths
   - Different depth thresholds for different object categories

2. **Semantic Category Expansion**
   - Analyze which WordNet paths aren't covered by semantic categories
   - Add new categories based on merge point analysis

3. **Path Similarity Metrics**
   - Compute path distance between objects
   - Use for improved mid-level grouping

4. **Interactive Visualization**
   - Web-based explorer for navigating WordNet paths
   - Dynamic depth threshold adjustment

---

## Test Results

### Image 498335

- ✅ Pipeline completed successfully
- ✅ All 13 output files generated
- ✅ 18 objects processed
- ✅ 77 unique WordNet nodes identified
- ✅ 18 merge points found
- ✅ Depth range: 0-10 from root
- ✅ Compression: Fine→Mid 1.80x, Fine→Coarse 2.00x

### File Sizes

- WordNet paths tree: 721 KB
- Merge analysis: 183 KB
- Depth distribution: 65 KB
- WordNet paths data: 23 KB
- Analysis report: 4.8 KB

---

## Conclusion

V6.2 successfully extends v6.1 with comprehensive WordNet path analysis and depth visualization. The new visualizations and reports provide valuable insights for:

- ✅ Validating current granularity definitions
- ✅ Understanding merge behavior in WordNet taxonomy
- ✅ Identifying optimal depth thresholds
- ✅ Debugging unexpected concept assignments
- ✅ Data-driven refinement of semantic categories

**Recommendation**: Use v6.2 for all future multi-granularity scene graph generation and analysis.

---

**Location**: `/home/jiachen/scratch/graph_reasoning/HCNMN/inspect/vg/v6.2/`
**Documentation**: This file + per-sample WORDNET_ANALYSIS_REPORT.md files
